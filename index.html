
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Research Hub (Gemini 2.5 Flash)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f4f8; }
        .card { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .gemini-result { white-space: pre-wrap; word-wrap: break-word; max-height: 500px; overflow-y: auto; background-color: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; line-height: 1.6; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Markdown-like styling for results */
        .gemini-result h2 { font-weight: bold; font-size: 1.2em; margin-top: 1em; color: #1e3a8a; }
        .gemini-result ul { list-style-type: disc; margin-left: 1.5em; margin-bottom: 1em; }
        .gemini-result li { margin-bottom: 0.5em; }
        .gemini-result strong { color: #111827; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen px-4 py-8">

    <div class="w-full max-w-lg bg-white rounded-xl card p-8 sm:p-10 relative">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800">Stock Research Hub</h1>
            <p class="text-green-600 font-medium text-sm mt-1">Made by BAM Teerawat</p>
        </div>

        <div class="space-y-4">
            <div>
                <label for="ticker" class="block text-sm font-bold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏ô (Ticker)</label>
                <div class="relative">
                    <input type="text" id="ticker" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg uppercase tracking-wide placeholder-gray-400" 
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô PTT, AAPL, TSM" required autofocus>
                </div>
            </div>
        </div>

        <div class="mt-8 space-y-3">
            <button type="button" id="n8nSubmitButton" class="w-full group relative flex justify-center items-center bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-all shadow-md active:scale-[0.98]">
                <span>üì® ‡∏™‡πà‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏Ç‡πâ‡∏≤ Email (Deep Analysis)</span>
            </button>
            
            <div class="grid grid-cols-2 gap-3">
                <button type="button" id="summarizeNewsBtn" class="flex justify-center items-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-all shadow-md active:scale-[0.98]">
                    <span>üì∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
                </button>
                <button type="button" id="suggestSimilarBtn" class="flex justify-center items-center bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700 transition-all shadow-md active:scale-[0.98]">
                    <span>ü§ù ‡∏´‡∏∏‡πâ‡∏ô‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á</span>
                </button>
            </div>
        </div>
        
        <div id="statusMessage" class="mt-6 text-center text-sm font-medium min-h-[20px]"></div>

        <div id="geminiResultCard" class="mt-6 hidden animate-fade-in">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-gray-800">üí° ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å AI:</h3>
                <button onclick="copyToClipboard()" class="text-xs text-gray-500 hover:text-blue-600 underline">Copy</button>
            </div>
            <div id="geminiResultContent" class="text-gray-700 text-sm gemini-result"></div>
        </div>
    </div>

    <script>
        // ==========================================
        //  ‚öôÔ∏è ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (CONFIGURATION)
        // ==========================================
        
        // 1. ‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏û‡∏π‡∏î)
        const geminiApiKey = "AIzaSyDZr_bh6Ue2Rm69fcQtC-B0NdjDczd5knk"; 

        // 2. URL ‡∏Ç‡∏≠‡∏á n8n Webhook
        const n8nWebhookUrl = "https://my-n8n-system-email.duckdns.org/webhook/eeaef21a-6c9e-4745-9da6-31dba189d63d/eeaef21a-6c9e-4745-9da6-31dba189d63d/analyze/:ticker";

        // 3. ‡∏ä‡∏∑‡πà‡∏≠ Model (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ä‡πá‡∏Ñ‡∏°‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
        const MODEL_NAME = 'gemini-2.5-flash';

        // ==========================================
        //  üîß ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (LOGIC)
        // ==========================================

        const tickerInput = document.getElementById('ticker');
        const statusMessage = document.getElementById('statusMessage');
        const n8nSubmitButton = document.getElementById('n8nSubmitButton');
        const summarizeNewsBtn = document.getElementById('summarizeNewsBtn');
        const suggestSimilarBtn = document.getElementById('suggestSimilarBtn');
        const geminiResultCard = document.getElementById('geminiResultCard');
        const geminiResultContent = document.getElementById('geminiResultContent');

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏° Loading
        function setLoading(button, isLoading, loadingText = "") {
            const textSpan = button.querySelector('span');
            if (isLoading) {
                button.disabled = true;
                button.classList.add('opacity-75', 'cursor-not-allowed');
                button.dataset.originalText = textSpan ? textSpan.textContent : '';
                if(textSpan) textSpan.innerHTML = `<div class="loader mr-2"></div> ${loadingText}`;
            } else {
                button.disabled = false;
                button.classList.remove('opacity-75', 'cursor-not-allowed');
                if(textSpan && button.dataset.originalText) textSpan.textContent = button.dataset.originalText;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function showStatus(msg, type = 'info') {
            statusMessage.textContent = msg;
            if (type === 'error') statusMessage.className = 'mt-6 text-center text-sm text-red-600 font-bold';
            else if (type === 'success') statusMessage.className = 'mt-6 text-center text-sm text-green-600 font-bold';
            else statusMessage.className = 'mt-6 text-center text-sm text-gray-600 animate-pulse';
        }

        // 1. Logic ‡∏õ‡∏∏‡πà‡∏° n8n (‡∏™‡πà‡∏á Email)
        n8nSubmitButton.addEventListener('click', function() {
            const ticker = tickerInput.value.toUpperCase().trim();
            if (!ticker) { showStatus('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô', 'error'); return; }

            const finalUrl = n8nWebhookUrl.replace(':ticker', ticker);
            
            setLoading(n8nSubmitButton, true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
            showStatus(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ${ticker} ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏ö Email...`);
            geminiResultCard.classList.add('hidden');

            fetch(finalUrl)
                .then(response => {
                    // n8n ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Text ‡∏´‡∏£‡∏∑‡∏≠ JSON ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà 200 OK
                    if (response.ok) {
                        showStatus(`‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ Email ‡πÉ‡∏ô 1-3 ‡∏ô‡∏≤‡∏ó‡∏µ`, 'success');
                    } else {
                        throw new Error(`Server status: ${response.status}`);
                    }
                })
                .catch(error => {
                    console.error('n8n Error:', error);
                    showStatus(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
                })
                .finally(() => setLoading(n8nSubmitButton, false));
        });

        // 2. Logic ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Gemini API
        async function callGeminiApi(prompt, button, useGrounding = false) {
            const ticker = tickerInput.value.toUpperCase().trim();
            if (!ticker) { showStatus('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô', 'error'); return; }
            
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÉ‡∏™‡πà Key ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            if (geminiApiKey.includes("‡πÉ‡∏™‡πà_API_KEY")) {
                showStatus('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'error');
                return;
            }

            setLoading(button, true, "AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...");
            showStatus('Gemini 2.5 Flash ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...');
            geminiResultCard.classList.add('hidden');
            geminiResultContent.textContent = '';

            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${geminiApiKey}`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }]
            };

            // ‡πÄ‡∏õ‡∏¥‡∏î Google Search Grounding (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
            if (useGrounding) {
                payload.tools = [{ google_search: {} }];
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error?.message || `HTTP Error: ${response.status}`);
                }

                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
                if (data.candidates && data.candidates[0].content) {
                    const resultText = data.candidates[0].content.parts.map(p => p.text).join('\n');
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                    geminiResultContent.textContent = resultText;
                    geminiResultCard.classList.remove('hidden');
                    showStatus('‚úÖ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!', 'success');
                } else {
                    throw new Error("AI ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Empty Response)");
                }

            } catch (error) {
                console.error('Gemini API Error:', error);
                showStatus(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
                geminiResultContent.textContent = `Debug Info:\n${error.message}`;
                geminiResultCard.classList.remove('hidden');
            } finally {
                setLoading(button, false);
            }
        }

        // ‡∏õ‡∏∏‡πà‡∏° 2: ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πà‡∏≤‡∏ß
        summarizeNewsBtn.addEventListener('click', () => {
            const ticker = tickerInput.value.toUpperCase().trim();
            const prompt = `‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 3-5 ‡∏Ç‡πà‡∏≤‡∏ß ‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô "${ticker}" ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡πÜ`;
            callGeminiApi(prompt, summarizeNewsBtn, true); // true = ‡πÉ‡∏ä‡πâ Grounding (Search)
        });

        // ‡∏õ‡∏∏‡πà‡∏° 3: ‡∏´‡∏∏‡πâ‡∏ô‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á
        suggestSimilarBtn.addEventListener('click', () => {
            const ticker = tickerInput.value.toUpperCase().trim();
            const prompt = `‡∏´‡∏∏‡πâ‡∏ô "${ticker}" ‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏≠‡∏∞‡πÑ‡∏£? ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏∏‡πâ‡∏ô‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡πÉ‡∏ô‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏°‡∏≤ 3 ‡∏ï‡∏±‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)`;
            callGeminiApi(prompt, suggestSimilarBtn, false); // false = ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Search (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ AI)
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Copy
        function copyToClipboard() {
            const text = geminiResultContent.textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!');
            });
        }
    </script>
</body>
</html>
